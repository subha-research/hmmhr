{"version":3,"file":"FormView-Bm8LD5wO.js","sources":["../../../../frontend/src/composables/index.js","../../../../frontend/src/utils/commonUtils.js","../../../../frontend/src/components/FormView.vue"],"sourcesContent":["import { createResource, toast } from \"frappe-ui\"\n\nfunction getFileReader() {\n\tconst fileReader = new FileReader()\n\tconst zoneOriginalInstance = fileReader[\"__zone_symbol__originalInstance\"]\n\treturn zoneOriginalInstance || fileReader\n}\n\nexport class FileAttachment {\n\tconstructor(fileObj) {\n\t\tthis.fileObj = fileObj\n\t\tthis.fileName = fileObj.name\n\t}\n\n\tasync upload(documentType, documentName, fieldName) {\n\t\treturn new Promise(async (resolve, reject) => {\n\t\t\tconst reader = getFileReader()\n\t\t\tconst uploader = createResource({\n\t\t\t\turl: \"hrms.api.upload_base64_file\",\n\t\t\t\tonSuccess: (fileDoc) => resolve(fileDoc),\n\t\t\t\tonError: (error) => {\n\t\t\t\t\ttoast({\n\t\t\t\t\t\ttitle: \"Error\",\n\t\t\t\t\t\ttext: `File upload failed for ${this.fileName}. ${\n\t\t\t\t\t\t\terror.messages?.[0] || \"\"\n\t\t\t\t\t\t}`,\n\t\t\t\t\t\ticon: \"alert-circle\",\n\t\t\t\t\t\tposition: \"bottom-center\",\n\t\t\t\t\t\ticonClasses: \"text-red-500\",\n\t\t\t\t\t})\n\t\t\t\t\treject(error)\n\t\t\t\t},\n\t\t\t})\n\n\t\t\treader.onload = () => {\n\t\t\t\tconsole.log(\"Loaded successfully ✅\")\n\t\t\t\tthis.fileContents = reader.result.toString().split(\",\")[1]\n\n\t\t\t\tuploader.submit({\n\t\t\t\t\tcontent: this.fileContents,\n\t\t\t\t\tdt: documentType,\n\t\t\t\t\tdn: documentName,\n\t\t\t\t\tfilename: this.fileName,\n\t\t\t\t\tfieldname: fieldName,\n\t\t\t\t})\n\t\t\t}\n\t\t\treader.readAsDataURL(this.fileObj)\n\t\t})\n\t}\n\n\tdelete() {\n\t\treturn createResource({\n\t\t\turl: \"hrms.api.delete_attachment\",\n\t\t\tonSuccess: () => {\n\t\t\t\tconsole.log(\"Deleted successfully ✅\")\n\t\t\t},\n\t\t\tonError: (error) => {\n\t\t\t\ttoast({\n\t\t\t\t\ttitle: \"Error\",\n\t\t\t\t\ttext: `File deletion failed. ${error.messages?.[0] || \"\"}`,\n\t\t\t\t\ticon: \"alert-circle\",\n\t\t\t\t\tposition: \"bottom-center\",\n\t\t\t\t\ticonClasses: \"text-red-500\",\n\t\t\t\t})\n\t\t\t},\n\t\t}).submit({\n\t\t\tfilename: this.fileName,\n\t\t})\n\t}\n}\n\nconst hasWords = (list, status) => list.some((word) => status.includes(word))\n\nexport async function guessStatusColor(doctype, status) {\n\tconst statesResource = createResource({\n\t\turl: \"hrms.api.get_doctype_states\",\n\t\tparams: { doctype: doctype },\n\t})\n\n\tconst stateMap = await statesResource.reload()\n\n\tif (Object.keys(stateMap || {})?.length) {\n\t\tif (stateMap?.[status] === \"yellow\") return \"orange\"\n\t\tif (stateMap?.[status]) return stateMap?.[status]\n\t}\n\n\tlet color = \"gray\"\n\tstatus = status.toLowerCase()\n\n\tif (\n\t\thasWords(\n\t\t\t[\"open\", \"pending\", \"unpaid\", \"review\", \"medium\", \"not approved\"],\n\t\t\tstatus\n\t\t)\n\t) {\n\t\tcolor = \"orange\"\n\t} else if (\n\t\thasWords([\"urgent\", \"high\", \"failed\", \"rejected\", \"error\"], status)\n\t) {\n\t\tcolor = \"red\"\n\t} else if (\n\t\thasWords(\n\t\t\t[\n\t\t\t\t\"closed\",\n\t\t\t\t\"finished\",\n\t\t\t\t\"converted\",\n\t\t\t\t\"completed\",\n\t\t\t\t\"complete\",\n\t\t\t\t\"confirmed\",\n\t\t\t\t\"approved\",\n\t\t\t\t\"yes\",\n\t\t\t\t\"active\",\n\t\t\t\t\"available\",\n\t\t\t\t\"success\",\n\t\t\t],\n\t\t\tstatus\n\t\t)\n\t) {\n\t\tcolor = \"green\"\n\t} else if (status === \"submitted\") {\n\t\tcolor = \"blue\"\n\t}\n\n\treturn color\n}\n","import { toast } from \"frappe-ui\"\n\nexport function useDownloadPDF() {\n\tasync function downloadPDF({ doctype, docname, filename = null }) {\n\t\t\n\t\tconst headers = {\n\t\t\t\"X-Frappe-Site-Name\": window.location.hostname,\n\t\t}\n\t\tif (window.csrf_token) {\n\t\t\theaders[\"X-Frappe-CSRF-Token\"] = window.csrf_token\n\t\t}\n\n\t\tfetch(\"/api/method/hrms.api._download_pdf\", {\n\t\t\tmethod: \"POST\",\n\t\t\theaders,\n\t\t\tbody: new URLSearchParams({ doctype: doctype, docname: docname }),\n\t\t\tresponseType: \"blob\",\n\t\t}).then((response) => {\n\t\t\t\tif (response.ok) {\n\t\t\t\t\treturn response.blob()\n\t\t\t\t} else {\n\t\t\t\t\ttoast({\n\t\t\t\t\t\ttitle: \"Download Failed\",\n\t\t\t\t\t\ttext: `Error downloading PDF`,\n\t\t\t\t\t\ttype: \"error\",\n\t\t\t\t\t\ticon: \"alert-circle\",\n\t\t\t\t\t\tposition: \"bottom-center\",\n\t\t\t\t\t\ticonClasses: \"text-red-500\",\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t})\n\t\t\t.then((blob) => {\n\t\t\t\tif (!blob) return\n\t\t\t\tconst blobUrl = window.URL.createObjectURL(blob)\n\t\t\t\tconst link = document.createElement(\"a\")\n\t\t\t\tlink.href = blobUrl\n\t\t\t\tlink.download = `${filename || docname}.pdf`\n\t\t\t\tlink.click()\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\twindow.URL.revokeObjectURL(blobUrl)\n\t\t\t\t}, 3000)\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\ttoast({\n\t\t\t\t\ttitle: __(\"Error\"),\n\t\t\t\t\ttext: __(\"Error downloading PDF\", [__(error)]),\n\t\t\t\t\ticon: \"alert-circle\",\n\t\t\t\t\tposition: \"bottom-center\",\n\t\t\t\t\ticonClasses: \"text-red-500\",\n\t\t\t\t})\n\t\t\t})\n\t}\n\n\treturn {\n\t\tdownloadPDF,\n\t}\n}\n","<template>\n\t<div class=\"flex flex-col h-full w-full\" v-if=\"isFormReady\">\n\t\t<div class=\"w-full h-full bg-white sm:w-96 flex flex-col\">\n\t\t\t<header\n\t\t\t\tclass=\"flex flex-row bg-white shadow-sm py-4 px-3 items-center sticky top-0 z-[1000]\"\n\t\t\t>\n\t\t\t\t<Button\n\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\tclass=\"!pl-0 hover:bg-white\"\n\t\t\t\t\t@click=\"router.back()\"\n\t\t\t\t>\n\t\t\t\t\t<FeatherIcon name=\"chevron-left\" class=\"h-5 w-5\" />\n\t\t\t\t</Button>\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"id\"\n\t\t\t\t\tclass=\"flex flex-row items-center gap-2 overflow-hidden grow\"\n\t\t\t\t>\n\t\t\t\t\t<h2\n\t\t\t\t\t\tclass=\"text-xl font-semibold text-gray-900 whitespace-nowrap overflow-hidden text-ellipsis\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ __(props.doctype) }}\n\t\t\t\t\t</h2>\n\t\t\t\t\t<Badge\n\t\t\t\t\t\t:label=\"id\"\n\t\t\t\t\t\tclass=\"whitespace-nowrap text-[8px]\"\n\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t/>\n\t\t\t\t\t<Badge\n\t\t\t\t\t\tv-if=\"status\"\n\t\t\t\t\t\t:label=\"__(status, null, doctype)\"\n\t\t\t\t\t\t:theme=\"statusColor\"\n\t\t\t\t\t\tclass=\"whitespace-nowrap text-[8px]\"\n\t\t\t\t\t/>\n\n\t\t\t\t\t<Dropdown\n\t\t\t\t\t\tclass=\"ml-auto\"\n\t\t\t\t\t\t:options=\"[\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlabel: __('Delete'),\n\t\t\t\t\t\t\t\tcondition: showDeleteButton,\n\t\t\t\t\t\t\t\tonClick: () => (showDeleteDialog = true),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{ label: __('Reload'), onClick: () => reloadDoc() },\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlabel: __('Download PDF'),\n\t\t\t\t\t\t\t\tcondition: () => props.showDownloadPDFButton,\n\t\t\t\t\t\t\t\tonClick: () => (handleDownload()),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t]\"\n\t\t\t\t\t\t:button=\"{\n\t\t\t\t\t\t\tlabel: __('Menu'),\n\t\t\t\t\t\t\ticon: 'more-horizontal',\n\t\t\t\t\t\t\tvariant: 'ghost',\n\t\t\t\t\t\t}\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<h2 v-else class=\"text-2xl font-semibold text-gray-900\">\n\t\t\t\t\t{{ __('New {0}', [__(doctype)], props.doctype) }}\n\t\t\t\t</h2>\n\t\t\t</header>\n\n\t\t\t<!-- Form -->\n\t\t\t<div class=\"bg-white grow overflow-y-auto\">\n\t\t\t\t<!-- Tabs -->\n\t\t\t\t<template v-if=\"tabbedView\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"px-4 sticky top-0 z-[100] bg-white text-sm font-medium text-center text-gray-500 border-b border-gray-200 dark:text-gray-400 dark:border-gray-700\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<ul class=\"flex -mb-px overflow-auto hide-scrollbar\">\n\t\t\t\t\t\t\t<li class=\"mr-2 whitespace-nowrap\" v-for=\"tab in tabs\">\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t@click=\"activeTab = tab.name\"\n\t\t\t\t\t\t\t\t\tclass=\"inline-block py-4 px-2 border-b-2 border-transparent rounded-t-lg\"\n\t\t\t\t\t\t\t\t\t:class=\"[\n\t\t\t\t\t\t\t\t\t\tactiveTab === tab.name\n\t\t\t\t\t\t\t\t\t\t\t? '!text-gray-800 !border-gray-800'\n\t\t\t\t\t\t\t\t\t\t\t: 'hover:text-gray-600 hover:border-gray-300',\n\t\t\t\t\t\t\t\t\t]\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{{ __(tab.name, null, props.doctype) }}\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<template v-for=\"(fieldList, tabName, index) in tabFields\">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-show=\"tabName === activeTab\"\n\t\t\t\t\t\t\tclass=\"flex flex-col space-y-4 p-4\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<template v-for=\"field in fieldList\" :key=\"field.fieldname\">\n\t\t\t\t\t\t\t\t<slot\n\t\t\t\t\t\t\t\t\tv-if=\"field.fieldtype == 'Table'\"\n\t\t\t\t\t\t\t\t\t:name=\"field.fieldname\"\n\t\t\t\t\t\t\t\t\t:isFormReadOnly=\"isFormReadOnly\"\n\t\t\t\t\t\t\t\t></slot>\n\n\t\t\t\t\t\t\t\t<FormField\n\t\t\t\t\t\t\t\t\tv-else\n\t\t\t\t\t\t\t\t\t:fieldtype=\"field.fieldtype\"\n\t\t\t\t\t\t\t\t\t:fieldname=\"field.fieldname\"\n\t\t\t\t\t\t\t\t\tv-model=\"formModel[field.fieldname]\"\n\t\t\t\t\t\t\t\t\t:default=\"field.default\"\n\t\t\t\t\t\t\t\t\t:label=\"__(field.label, null, props.doctype)\"\n\t\t\t\t\t\t\t\t\t:options=\"field.options\"\n\t\t\t\t\t\t\t\t\t:linkFilters=\"field.linkFilters\"\n\t\t\t\t\t\t\t\t\t:documentList=\"field.documentList\"\n\t\t\t\t\t\t\t\t\t:readOnly=\"isFieldReadOnly(field)\"\n\t\t\t\t\t\t\t\t\t:reqd=\"Boolean(field.reqd)\"\n\t\t\t\t\t\t\t\t\t:hidden=\"Boolean(field.hidden)\"\n\t\t\t\t\t\t\t\t\t:errorMessage=\"field.error_message\"\n\t\t\t\t\t\t\t\t\t:minDate=\"field.minDate\"\n\t\t\t\t\t\t\t\t\t:maxDate=\"field.maxDate\"\n\t\t\t\t\t\t\t\t\t:addSectionPadding=\"fieldList[0].name !== field.name\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t\t<!-- Attachment upload -->\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"flex flex-row gap-2 items-center justify-center p-5\"\n\t\t\t\t\t\t\t\tv-if=\"isFileUploading\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<LoadingIndicator class=\"w-3 h-3 text-gray-800\" />\n\t\t\t\t\t\t\t\t<span class=\"text-gray-900 text-sm\">{{ __(\"Uploading...\") }} </span>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<FileUploaderView\n\t\t\t\t\t\t\t\tv-else-if=\"showAttachmentView && index === 0\"\n\t\t\t\t\t\t\t\tv-model=\"fileAttachments\"\n\t\t\t\t\t\t\t\t@handleFileSelect=\"handleFileSelect\"\n\t\t\t\t\t\t\t\t@handleFileDelete=\"handleFileDelete\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t</template>\n\n\t\t\t\t<div class=\"flex flex-col space-y-4 p-4\" v-else>\n\t\t\t\t\t<FormField\n\t\t\t\t\t\tv-for=\"field in props.fields\"\n\t\t\t\t\t\t:key=\"field.name\"\n\t\t\t\t\t\t:fieldtype=\"field.fieldtype\"\n\t\t\t\t\t\t:fieldname=\"field.fieldname\"\n\t\t\t\t\t\tv-model=\"formModel[field.fieldname]\"\n\t\t\t\t\t\t:default=\"field.default\"\n\t\t\t\t\t\t:label=\"__(field.label, null, props.doctype)\"\n\t\t\t\t\t\t:options=\"field.options\"\n\t\t\t\t\t\t:linkFilters=\"field.linkFilters\"\n\t\t\t\t\t\t:documentList=\"field.documentList\"\n\t\t\t\t\t\t:readOnly=\"isFieldReadOnly(field)\"\n\t\t\t\t\t\t:reqd=\"Boolean(field.reqd)\"\n\t\t\t\t\t\t:hidden=\"Boolean(field.hidden)\"\n\t\t\t\t\t\t:errorMessage=\"field.error_message\"\n\t\t\t\t\t\t:minDate=\"field.minDate\"\n\t\t\t\t\t\t:maxDate=\"field.maxDate\"\n\t\t\t\t\t/>\n\n\t\t\t\t\t<!-- Attachment upload -->\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"flex flex-row gap-2 items-center justify-center p-5\"\n\t\t\t\t\t\tv-if=\"isFileUploading\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<LoadingIndicator class=\"w-3 h-3 text-gray-800\" />\n\t\t\t\t\t\t<span class=\"text-gray-900 text-sm\">{{ __(\"Uploading...\") }} </span>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<FileUploaderView\n\t\t\t\t\t\tv-else-if=\"showAttachmentView\"\n\t\t\t\t\t\tv-model=\"fileAttachments\"\n\t\t\t\t\t\t@handleFileSelect=\"handleFileSelect\"\n\t\t\t\t\t\t@handleFileDelete=\"handleFileDelete\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<!-- Form Primary/Secondary Button -->\n\t\t\t<!-- custom form button eg: Download button in salary slips -->\n\t\t\t<div\n\t\t\t\tv-if=\"!showFormButton\"\n\t\t\t\tclass=\"px-4 pt-4 pb-4 standalone:pb-safe-bottom sm:w-96 bg-white sticky bottom-0 w-full drop-shadow-xl z-40 border-t rounded-t-lg\"\n\t\t\t>\n\t\t\t\t<slot name=\"formButton\"></slot>\n\t\t\t</div>\n\n\t\t\t<!-- workflow actions -->\n\t\t\t<WorkflowActionSheet\n\t\t\t\tv-else-if=\"!isFormDirty && workflow?.hasWorkflow\"\n\t\t\t\t:doc=\"documentResource.doc\"\n\t\t\t\t:workflow=\"workflow\"\n\t\t\t\t@workflowApplied=\"reloadDoc()\"\n\t\t\t/>\n\n\t\t\t<!-- save/submit/cancel -->\n\t\t\t<div\n\t\t\t\tv-else-if=\"isFormDirty || (!workflow?.hasWorkflow && formButton)\"\n\t\t\t\tclass=\"px-4 pt-4 pb-4 standalone:pb-safe-bottom sm:w-96 bg-white sticky bottom-0 w-full drop-shadow-xl z-40 border-t rounded-t-lg\"\n\t\t\t>\n\t\t\t\t<ErrorMessage\n\t\t\t\t\tclass=\"mb-2\"\n\t\t\t\t\t:message=\"\n\t\t\t\t\t\tformErrorMessage ||\n\t\t\t\t\t\tdocList?.insert?.error ||\n\t\t\t\t\t\tdocumentResource?.setValue?.error\n\t\t\t\t\t\"\n\t\t\t\t/>\n\n\t\t\t\t<Button\n\t\t\t\t\tclass=\"w-full rounded py-5 text-base disabled:bg-gray-700 disabled:text-white\"\n\t\t\t\t\t:class=\"formButton === 'Cancel' ? 'shadow' : ''\"\n\t\t\t\t\t@click=\"formButton === 'Save' ? saveForm() : submitOrCancelForm()\"\n\t\t\t\t\t:variant=\"formButton === 'Cancel' ? 'subtle' : 'solid'\"\n\t\t\t\t\t:loading=\"\n\t\t\t\t\t\tdocList.insert.loading || documentResource?.setValue?.loading\n\t\t\t\t\t\"\n\t\t\t\t>\n\t\t\t\t\t{{ __(formButton) }}\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t<!-- Confirmation Dialogs -->\n\t<Dialog v-model=\"showDeleteDialog\">\n\t\t<template #body-title>\n\t\t\t<h2 class=\"text-xl font-bold\">{{ __(\"Delete {0}\", [__(props.doctype)]) }}</h2>\n\t\t</template>\n\t\t<template #body-content>\n\t\t\t<p>\n\t\t\t\t{{ __(\"Are you sure you want to delete the {0}\", [__(props.doctype)])  }}\n\t\t\t\t<span class=\"font-bold\">{{ formModel.name }}</span>\n\t\t\t\t?\n\t\t\t</p>\n\t\t</template>\n\t\t<template #actions>\n\t\t\t<div class=\"flex flex-row gap-4\">\n\t\t\t\t<Button\n\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\tclass=\"py-5 w-full\"\n\t\t\t\t\t@click=\"showDeleteDialog = false\"\n\t\t\t\t>\n\t\t\t\t\t{{ __(\"Cancel\") }}\n\t\t\t\t</Button>\n\t\t\t\t<Button\n\t\t\t\t\tvariant=\"solid\"\n\t\t\t\t\ttheme=\"red\"\n\t\t\t\t\t@click=\"handleDocDelete\"\n\t\t\t\t\tclass=\"py-5 w-full\"\n\t\t\t\t>\n\t\t\t\t\t{{__(\"Delete\") }}\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t</template>\n\t</Dialog>\n\n\t<Dialog v-model=\"showSubmitDialog\">\n\t\t<template #body-title>\n\t\t\t<h2 class=\"text-xl font-bold\">{{ __(\"Confirm\") }} </h2>\n\t\t</template>\n\t\t<template #body-content>\n\t\t\t<p>\n\t\t\t\t{{ __(\"Permanently submit {0}\", [__(props.doctype)]) }}\n\t\t\t\t<span class=\"font-bold\">{{ formModel.name }}</span>\n\t\t\t\t?\n\t\t\t</p>\n\t\t</template>\n\t\t<template #actions>\n\t\t\t<div class=\"flex flex-row gap-4\">\n\t\t\t\t<Button\n\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\tclass=\"py-5 w-full\"\n\t\t\t\t\t@click=\"showSubmitDialog = false\"\n\t\t\t\t>\n\t\t\t\t\t{{ __(\"No\") }}\n\t\t\t\t</Button>\n\t\t\t\t<Button\n\t\t\t\t\tvariant=\"solid\"\n\t\t\t\t\t@click=\"handleDocUpdate('submit')\"\n\t\t\t\t\tclass=\"py-5 w-full\"\n\t\t\t\t>\n\t\t\t\t\t{{ __(\"Yes\") }}\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t</template>\n\t</Dialog>\n\n\t<Dialog v-model=\"showCancelDialog\">\n\t\t<template #body-title>\n\t\t\t<h2 class=\"text-xl font-bold\">{{ __(\"Confirm\") }} </h2>\n\t\t</template>\n\t\t<template #body-content>\n\t\t\t<p>\n\t\t\t\t{{ __(\"Permanently cancel {0}\", [__(props.doctype)]) }}\n\t\t\t\t<span class=\"font-bold\">{{ formModel.name }}</span\n\t\t\t\t>?\n\t\t\t</p>\n\t\t</template>\n\t\t<template #actions>\n\t\t\t<div class=\"flex flex-row gap-4\">\n\t\t\t\t<Button\n\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\tclass=\"py-5 w-full\"\n\t\t\t\t\t@click=\"showCancelDialog = false\"\n\t\t\t\t>\n\t\t\t\t\t{{ __(\"No\") }}\n\t\t\t\t</Button>\n\t\t\t\t<Button\n\t\t\t\t\tvariant=\"solid\"\n\t\t\t\t\t@click=\"handleDocUpdate('cancel')\"\n\t\t\t\t\tclass=\"py-5 w-full\"\n\t\t\t\t>\n\t\t\t\t\t{{ __(\"Yes\") }}\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t</template>\n\t</Dialog>\n</template>\n\n<script setup>\nimport { computed, inject, nextTick, onMounted, ref, watch } from \"vue\"\nimport { useRouter } from \"vue-router\"\nimport {\n\tErrorMessage,\n\tBadge,\n\tFeatherIcon,\n\tcreateListResource,\n\tcreateDocumentResource,\n\ttoast,\n\tcreateResource,\n\tDropdown,\n\tDialog,\n\tLoadingIndicator,\n} from \"frappe-ui\"\nimport FormField from \"@/components/FormField.vue\"\nimport FileUploaderView from \"@/components/FileUploaderView.vue\"\nimport WorkflowActionSheet from \"@/components/WorkflowActionSheet.vue\"\n\nimport { FileAttachment, guessStatusColor } from \"@/composables\"\nimport useWorkflow from \"@/composables/workflow\"\nimport { getCompanyCurrency } from \"@/data/currencies\"\nimport { formatCurrency } from \"@/utils/formatters\"\nimport { useDownloadPDF } from \"@/utils/commonUtils\"\n\nconst props = defineProps({\n\tdoctype: {\n\t\ttype: String,\n\t\trequired: true,\n\t},\n\tmodelValue: {\n\t\ttype: Object,\n\t\trequired: true,\n\t},\n\tisSubmittable: {\n\t\ttype: Boolean,\n\t\trequired: false,\n\t\tdefault: false,\n\t},\n\tfields: {\n\t\ttype: Array,\n\t\trequired: true,\n\t},\n\tid: {\n\t\ttype: String,\n\t\trequired: false,\n\t},\n\ttabbedView: {\n\t\ttype: Boolean,\n\t\trequired: false,\n\t\tdefault: false,\n\t},\n\ttabs: {\n\t\ttype: Array,\n\t\trequired: false,\n\t},\n\tshowAttachmentView: {\n\t\ttype: Boolean,\n\t\trequired: false,\n\t\tdefault: false,\n\t},\n\tshowFormButton: {\n\t\ttype: Boolean,\n\t\trequired: false,\n\t\tdefault: true,\n\t},\n\tshowDownloadPDFButton: {\n\t\ttype: Boolean,\n\t\trequired: false,\n\t\tdefault: false,\n\t},\n})\nconst emit = defineEmits([\"validateForm\", \"update:modelValue\"])\nconst router = useRouter()\nconst { downloadPDF } = useDownloadPDF()\n\nconst __ = inject(\"$translate\")\n\nlet activeTab = ref(props.tabs?.[0].name)\nlet fileAttachments = ref([])\nlet statusColor = ref(\"\")\nlet formErrorMessage = ref(\"\")\nlet isFormDirty = ref(false)\nlet isFormUpdated = ref(false)\nlet showDeleteDialog = ref(false)\nlet showSubmitDialog = ref(false)\nlet showCancelDialog = ref(false)\nlet isFileUploading = ref(false)\nlet workflow = ref(null)\n\nconst formModel = computed({\n\tget() {\n\t\treturn props.modelValue\n\t},\n\tset(newValue) {\n\t\temit(\"update:modelValue\", newValue)\n\t},\n})\n\nconst status = computed(() => {\n\tif (!props.id) return \"\"\n\n\tif (workflow.value) {\n\t\tconst stateField = workflow.value.getWorkflowStateField()\n\t\tif (stateField) return formModel.value[stateField]\n\t}\n\n\treturn formModel.value.status || formModel.value.approval_status\n})\n\nwatch(\n\t() => formModel.value,\n\t() => {\n\t\tif (!props.id) return\n\n\t\tif (isFormReady.value && !isFormUpdated.value) {\n\t\t\tisFormDirty.value = true\n\t\t} else if (isFormUpdated.value) {\n\t\t\tisFormUpdated.value = false\n\t\t}\n\t},\n\t{ deep: true }\n)\n\nwatch(\n\t() => status.value,\n\tasync (value) => {\n\t\tif (!value) return\n\t\tstatusColor.value = await guessStatusColor(props.doctype, status.value)\n\t},\n\t{ immediate: true }\n)\n\nconst tabFields = computed(() => {\n\tlet fieldsByTab = {}\n\tlet fieldList = []\n\tlet firstFieldIndex = 0\n\tlet lastFieldIndex = 0\n\n\tprops.tabs?.forEach((tab) => {\n\t\tlastFieldIndex = props.fields.findIndex(\n\t\t\t(field) => field.fieldname === tab.lastField\n\t\t)\n\t\tfieldList = props.fields.slice(firstFieldIndex, lastFieldIndex + 1)\n\t\tfieldsByTab[tab.name] = fieldList\n\t\tfirstFieldIndex = lastFieldIndex + 1\n\t})\n\n\treturn fieldsByTab\n})\n\nconst attachedFiles = createResource({\n\turl: \"hmmhr.api.get_attachments\",\n\tparams: {\n\t\tdt: props.doctype,\n\t\tdn: props.id,\n\t},\n\ttransform(data) {\n\t\treturn data.map((file) => (file.uploaded = true))\n\t},\n\tonSuccess(data) {\n\t\tfileAttachments.value = data\n\t},\n})\n\nconst handleFileSelect = (e) => {\n\tif (props.id) {\n\t\tuploadAllAttachments(props.doctype, props.id, [...e.target.files])\n\t} else {\n\t\tfileAttachments.value.push(...e.target.files)\n\t}\n}\n\nconst handleFileDelete = async (fileObj) => {\n\tif (fileObj.uploaded) {\n\t\tconst fileAttachment = new FileAttachment(fileObj)\n\t\tawait fileAttachment.delete()\n\t\tawait attachedFiles.reload()\n\t} else {\n\t\tfileAttachments.value = fileAttachments.value.filter(\n\t\t\t(file) => file.name !== fileObj.name\n\t\t)\n\t}\n}\n\nasync function uploadAllAttachments(documentType, documentName, attachments) {\n\tisFileUploading.value = true\n\n\tconst uploadPromises = attachments.map((attachment) => {\n\t\tconst fileAttachment = new FileAttachment(attachment)\n\t\treturn fileAttachment\n\t\t\t.upload(documentType, documentName, \"\")\n\t\t\t.then((fileDoc) => {\n\t\t\t\tfileDoc.uploaded = true\n\t\t\t\tif (props.id) {\n\t\t\t\t\tfileAttachments.value.push(fileDoc)\n\t\t\t\t}\n\t\t\t})\n\t})\n\n\tawait Promise.allSettled(uploadPromises)\n\tisFileUploading.value = false\n}\n\n// CRUD for doc\nconst docList = createListResource({\n\tdoctype: props.doctype,\n\tinsert: {\n\t\tasync onSuccess(data) {\n\t\t\ttoast({\n\t\t\t\ttitle: __(\"Success\"),\n\t\t\t\ttext: __(\"{0} created successfully!\", [__(props.doctype)]),\n\t\t\t\ticon: \"check-circle\",\n\t\t\t\tposition: \"bottom-center\",\n\t\t\t\ticonClasses: \"text-green-500\",\n\t\t\t})\n\t\t\tawait uploadAllAttachments(data.doctype, data.name, fileAttachments.value)\n\n\t\t\trouter.replace({\n\t\t\t\tname: `${props.doctype.replace(/\\s+/g, \"\")}DetailView`,\n\t\t\t\tparams: { id: data.name },\n\t\t\t})\n\t\t},\n\t\tonError() {\n\t\t\ttoast({\n\t\t\t\ttitle: __(\"Error\"),\n\t\t\t\ttext: __(\"Error creating {0}\", [__(props.doctype)]),\n\t\t\t\ticon: \"alert-circle\",\n\t\t\t\tposition: \"bottom-center\",\n\t\t\t\ticonClasses: \"text-red-500\",\n\t\t\t})\n\t\t\tconsole.log(`Error creating ${props.doctype}`)\n\t\t},\n\t},\n})\n\nconst documentResource = createDocumentResource({\n\tdoctype: props.doctype,\n\tname: props.id,\n\tfields: \"*\",\n\tsetValue: {\n\t\tonSuccess() {\n\t\t\ttoast({\n\t\t\t\ttitle: __(\"Success\"),\n\t\t\t\ttext: __(\"{0} updated successfully!\", [__(props.doctype)]),\n\t\t\t\ticon: \"check-circle\",\n\t\t\t\tposition: \"bottom-center\",\n\t\t\t\ticonClasses: \"text-green-500\",\n\t\t\t})\n\t\t},\n\t\tonError() {\n\t\t\ttoast({\n\t\t\t\ttitle: __(\"Error\"),\n\t\t\t\ttext: __(\"Error updating {0}\", [__(props.doctype)]),\n\t\t\t\ticon: \"alert-circle\",\n\t\t\t\tposition: \"bottom-center\",\n\t\t\t\ticonClasses: \"text-red-500\",\n\t\t\t})\n\t\t\tconsole.log(`Error updating ${props.doctype}`)\n\t\t},\n\t},\n\tdelete: {\n\t\tonSuccess() {\n\t\t\trouter.back()\n\t\t\ttoast({\n\t\t\t\ttitle: __(\"Success\"),\n\t\t\t\ttext: __(\"{0} deleted successfully!\", [__(props.doctype)]),\n\t\t\t\ticon: \"check-circle\",\n\t\t\t\tposition: \"bottom-center\",\n\t\t\t\ticonClasses: \"text-green-500\",\n\t\t\t})\n\t\t},\n\t\tonError() {\n\t\t\ttoast({\n\t\t\t\ttitle: __(\"Error\"),\n\t\t\t\ttext: __(\"Error deleting {0}\", [__(props.doctype)]),\n\t\t\t\ticon: \"alert-circle\",\n\t\t\t\tposition: \"bottom-center\",\n\t\t\t\ticonClasses: \"text-red-500\",\n\t\t\t})\n\t\t\tconsole.log(`Error deleting ${props.doctype}`)\n\t\t},\n\t},\n})\n\nconst docPermissions = createResource({\n\turl: \"frappe.client.get_doc_permissions\",\n\tparams: { doctype: props.doctype, docname: props.id },\n})\n\nconst permittedWriteFields = createResource({\n\turl: \"hmmhr.api.get_permitted_fields_for_write\",\n\tparams: { doctype: props.doctype },\n})\n\nconst formButton = computed(() => {\n\tif (!props.showFormButton) return\n\n\tif (props.id && props.isSubmittable && !isFormDirty.value) {\n\t\tif (formModel.value.docstatus === 0 && hasPermission(\"submit\")) {\n\t\t\treturn \"Submit\"\n\t\t} else if (formModel.value.docstatus === 1 && hasPermission(\"cancel\")) {\n\t\t\treturn \"Cancel\"\n\t\t}\n\t} else if (formModel.value.docstatus !== 2) {\n\t\treturn \"Save\"\n\t}\n})\n\nfunction showDeleteButton() {\n\treturn props.id && formModel.value.docstatus !== 1 && hasPermission(\"delete\")\n}\n\nfunction hasPermission(action) {\n\treturn docPermissions.data?.permissions[action]\n}\n\nfunction isFieldReadOnly(field) {\n\treturn (\n\t\tBoolean(field.read_only)\n\t\t|| isFormReadOnly.value\n\t\t|| (props.id && !permittedWriteFields.data?.includes(field.fieldname))\n\t)\n}\n\nfunction handleDocInsert() {\n\tif (!validateMandatoryFields()) return\n\tdocList.insert.submit(formModel.value)\n}\n\nfunction validateMandatoryFields() {\n\tconst errorFields = props.fields\n\t\t.filter(\n\t\t\t(field) =>\n\t\t\t\tfield.reqd && !field.hidden && !formModel.value[field.fieldname]\n\t\t)\n\t\t.map((field) => field.label)\n\n\tif (errorFields.length) {\n\t\tformErrorMessage.value = `${errorFields.join(\", \")} ${\n\t\t\terrorFields.length > 1 ? \"fields are mandatory\" : \"field is mandatory\"\n\t\t}`\n\t\treturn false\n\t} else {\n\t\tformErrorMessage.value = \"\"\n\t\treturn true\n\t}\n}\n\nasync function handleDocUpdate(action) {\n\tif (documentResource.doc) {\n\t\tlet params = { ...formModel.value }\n\n\t\tif (!validateMandatoryFields()) return\n\n\t\tif (action == \"submit\") {\n\t\t\tparams.docstatus = 1\n\t\t} else if (action == \"cancel\") {\n\t\t\tparams.docstatus = 2\n\t\t}\n\t\t\n\t\tawait documentResource.setValue.submit(params)\n\t\tawait documentResource.get.promise\n\t\tresetForm()\n\t}\n\n\tif (action === \"submit\") showSubmitDialog.value = false\n\telse if (action === \"cancel\") showCancelDialog.value = false\n}\n\nfunction saveForm() {\n\temit(\"validateForm\")\n\n\tif (props.id) {\n\t\thandleDocUpdate()\n\t} else {\n\t\thandleDocInsert()\n\t}\n}\n\nfunction submitOrCancelForm() {\n\tif (isFormDirty.value) return\n\n\tif (formModel.value.docstatus === 0) {\n\t\temit(\"validateForm\")\n\t\tshowSubmitDialog.value = true\n\t} else if (formModel.value.docstatus === 1) {\n\t\tshowCancelDialog.value = true\n\t}\n}\n\nfunction handleDocDelete() {\n\tdocumentResource.delete.submit()\n\tshowDeleteDialog.value = false\n}\n\nasync function reloadDoc() {\n\tawait documentResource.reload()\n\tresetForm()\n}\n\nfunction resetForm() {\n\tformModel.value = { ...documentResource.doc }\n\tnextTick(() => {\n\t\tisFormDirty.value = false\n\t\tisFormUpdated.value = true\n\t})\n}\nfunction handleDownload() {\n\tif (!props.id) return\n\tdownloadPDF({\n\t\tdoctype: props.doctype,\n\t\tdocname: props.id,\n\t\tfilename: props.id,\n\t})\n}\n\nasync function setFormattedCurrency() {\n\tconst companyCurrency = await getCompanyCurrency(formModel.value.company)\n\n\tprops.fields.forEach((field) => {\n\t\tif (field.fieldtype !== \"Currency\") return\n\t\tif (!(field.readOnly || isFormReadOnly.value)) return\n\n\t\tif (field.options === \"currency\") {\n\t\t\tformModel.value[field.fieldname] = formatCurrency(\n\t\t\t\tformModel.value[field.fieldname],\n\t\t\t\tformModel.value.currency\n\t\t\t)\n\t\t} else {\n\t\t\tformModel.value[field.fieldname] = formatCurrency(\n\t\t\t\tformModel.value[field.fieldname],\n\t\t\t\tcompanyCurrency\n\t\t\t)\n\t\t}\n\t})\n}\n\nconst isFormReadOnly = computed(() => {\n\tif (!isFormReady.value) return true\n\tif (!props.id) return false\n\n\t// submitted & cancelled docs are read only\n\tif (formModel.value.docstatus !== 0) return true\n\n\t// read only due to workflow based on current user's roles\n\tif (workflow.value?.isReadOnly(formModel.value)) return true\n})\n\nconst isFormReady = computed(() => {\n\tif (!props.id) return true\n\n\treturn !documentResource.get.loading && documentResource.doc\n})\n\nonMounted(async () => {\n\tif (props.id) {\n\t\tawait documentResource.get.promise\n\t\tformModel.value = { ...documentResource.doc }\n\t\tawait docPermissions.reload()\n\t\tawait permittedWriteFields.reload()\n\t\tawait attachedFiles.reload()\n\t\tawait setFormattedCurrency()\n\n\t\t// workflow\n\t\tworkflow.value = useWorkflow(props.doctype)\n\n\t\tisFormDirty.value = false\n\t}\n})\n</script>\n"],"names":["getFileReader","fileReader","FileAttachment","fileObj","documentType","documentName","fieldName","__async","resolve","reject","reader","uploader","createResource","fileDoc","error","toast","_a","hasWords","list","status","word","guessStatusColor","doctype","stateMap","color","useDownloadPDF","downloadPDF","_0","docname","filename","headers","response","blob","blobUrl","link","props","__props","emit","__emit","router","useRouter","__","inject","activeTab","ref","fileAttachments","statusColor","formErrorMessage","isFormDirty","isFormUpdated","showDeleteDialog","showSubmitDialog","showCancelDialog","isFileUploading","workflow","formModel","computed","newValue","stateField","watch","isFormReady","value","tabFields","fieldsByTab","fieldList","firstFieldIndex","lastFieldIndex","tab","field","attachedFiles","data","file","handleFileSelect","e","uploadAllAttachments","handleFileDelete","attachments","uploadPromises","attachment","docList","createListResource","documentResource","createDocumentResource","docPermissions","permittedWriteFields","formButton","hasPermission","showDeleteButton","action","isFieldReadOnly","isFormReadOnly","handleDocInsert","validateMandatoryFields","errorFields","handleDocUpdate","params","__spreadValues","resetForm","saveForm","submitOrCancelForm","handleDocDelete","reloadDoc","nextTick","handleDownload","setFormattedCurrency","companyCurrency","getCompanyCurrency","formatCurrency","onMounted","useWorkflow"],"mappings":"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"}