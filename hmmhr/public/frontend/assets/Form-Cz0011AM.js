import{I as C,a as I}from"./index-CbDAEvbD.js";import{i as f,r as L,N as u,w as s,z as S,l as V,q as i,j as w,k as N,a3 as R}from"./frappe-ui-XXN5389g.js";import E from"./FormView-Bm8LD5wO.js";import"./FormField-BpF4IXAT.js";import"./Link-DllPwrQU.js";import"./FileUploaderView-BFlUUILK.js";import"./workflow-B8q7fBbJ.js";import"./formatters-DKvews8N.js";const K={__name:"Form",props:{id:{type:String,required:!1}},setup(A){const $=f("$dayjs"),x=f("$translate"),d=$().format("YYYY-MM-DD"),v=A,c=f("$employee"),n=L(c.data.name),a=L({}),r=u({url:"hrms.api.get_doctype_fields",params:{doctype:"Leave Application"},transform(e){return B(e).map(t=>(t.fieldname==="half_day_date"&&(t.hidden=!0),t.fieldname==="posting_date"&&(t.default=d),t))},onSuccess(e){y.reload(),p.reload()}});r.reload();const y=u({url:"hrms.api.get_leave_approval_details",params:{employee:n.value},onSuccess(e){q(e)}}),p=u({url:"hrms.api.get_leave_types",params:{employee:n.value,date:d},onSuccess(e){T(e)}});s(()=>a.value.employee,e=>{v.id&&e!==n.value&&j(),n.value=e,p.fetch({employee:n.value,date:d}),y.fetch({employee:n.value})}),s(()=>a.value.leave_type,e=>D()),s(()=>a.value.half_day,e=>g(e)),s(()=>a.value.half_day&&a.value.half_day_date,()=>h()),s(()=>a.value.from_date,e=>{a.value.to_date||(a.value.to_date=e),p.fetch({employee:n.value,date:e})}),s(()=>[a.value.from_date,a.value.to_date],([e,l])=>{k(e,l),b(),h()}),s(()=>a.value.leave_approver,e=>{var o,_;const l=r.data.find(m=>m.fieldname==="leave_approver"),t=(o=l==null?void 0:l.documentList)==null?void 0:o.find(m=>m.value===e);a.value.leave_approver_name=((_=t==null?void 0:t.label)==null?void 0:_.split(" : ")[1])||""});function B(e){const l=["naming_series","sb_other_details","salary_slip","letter_head"],t=["employee","employee_name","department","company","follow_via_email","status","posting_date"];return v.id||l.push(...t),e.filter(o=>!l.includes(o.fieldname))}function j(){a.value.leave_approver!==c.data.user_id&&r.data.map(e=>e.read_only=!0)}function k(e,l){if(!(e&&l))return;const t=e>l?x("To Date cannot be before From Date"):"",o=r.data.find(_=>_.fieldname==="from_date");o.error_message=t}function h(){if(!F())return;u({url:"hrms.hr.doctype.leave_application.leave_application.get_number_of_leave_days",params:{employee:n.value,leave_type:a.value.leave_type,from_date:a.value.from_date,to_date:a.value.to_date,half_day:a.value.half_day,half_day_date:a.value.half_day_date},onSuccess(l){a.value.total_leave_days=l}}).reload(),D()}function D(){if(!F())return;u({url:"hrms.hr.doctype.leave_application.leave_application.get_leave_balance_on",params:{employee:n.value,date:a.value.from_date,to_date:a.value.to_date,leave_type:a.value.leave_type,consider_all_leaves_in_the_allocation_period:1},onSuccess(l){a.value.leave_balance=l}}).reload()}function g(e){const l=r.data.find(t=>t.fieldname==="half_day_date");l.hidden=!e,l.reqd=e,e&&(a.value.from_date===a.value.to_date?a.value.half_day_date=a.value.from_date:b())}function b(){const e=r.data.find(l=>l.fieldname==="half_day_date");e.minDate=a.value.from_date,e.maxDate=a.value.to_date}function q(e){var t;const l=(t=r.data)==null?void 0:t.find(o=>o.fieldname==="leave_approver");l.reqd=e==null?void 0:e.is_mandatory,l.documentList=e==null?void 0:e.department_approvers.map(o=>({label:o.full_name?`${o.name} : ${o.full_name}`:o.name,value:o.name})),a.value.leave_approver||(a.value.leave_approver=e==null?void 0:e.leave_approver,a.value.leave_approver_name=e==null?void 0:e.leave_approver_name)}function T(e){const l=r.data.find(t=>t.fieldname==="leave_type");l.documentList=e==null?void 0:e.map(t=>({label:t,value:t}))}function F(){return a.value.from_date&&a.value.to_date&&a.value.leave_type}function Y(){g(a.value.half_day),a.value.employee=n.value}return(e,l)=>(w(),S(i(C),null,{default:V(()=>[N(i(I),{fullscreen:!0},{default:V(()=>[i(r).data?(w(),S(E,{key:0,doctype:"Leave Application",modelValue:a.value,"onUpdate:modelValue":l[0]||(l[0]=t=>a.value=t),isSubmittable:!0,fields:i(r).data,id:v.id,showAttachmentView:!0,onValidateForm:Y},null,8,["modelValue","fields","id"])):R("",!0)]),_:1})]),_:1}))}};export{K as default};
//# sourceMappingURL=Form-Cz0011AM.js.map
